@model WebCode01.ViewModels.ProjectFileViewModel
@{
    ViewBag.Title = "Editor";
}

<h2>@ViewBag.name</h2>


<div class="row">
    <div id="editor" class="col-md-10">
        @ViewBag.Code
    </div>
</div>

@section scripts
{
    <script src="~/AceEditor/src/ace.js" type="text/javascript" charset="utf-8"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
     <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script src="~/AceEditor/src/ext-modelist.js"></script>
    <script>
        function getModeByFileExtension(path){
            var modelist = ace.require("ace/ext/modelist");
            return modelist.getModeForPath(path).mode;
        }
        var fileId = @ViewBag.id;
        var fileName = '@ViewBag.name';
        var mode = getModeByFileExtension(fileName); // Now ace editor view supports all languages that ace editor supports
     
            
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/monokai");
        editor.getSession().setMode(mode);
                       
        var codeHub = $.connection.codeHub;
        var silent = false;
        codeHub.client.onChange = function (changeData)
        {
            console.log(changeData);
            silent = true;
            editor.getSession().getDocument().applyDelta(changeData);
            silent = false;
        };

        $.connection.hub.start().done(function ()
        {
            codeHub.server.joinDocument(fileId);
            editor.on("change", function (obj)
            {
                if (silent)
                {
                    return;
                }
                console.log(obj);
                var content = editor.getSession().getValue();
                codeHub.server.onChange(obj, fileId, content);
            });

        });
    </script>

}










    
 


